<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Inventory Tracker (Google Sheets)</title>
<style>
  body{font-family:Arial,Helvetica,sans-serif;background:#f5f6fa;margin:0;padding:20px}
  .container{max-width:900px;margin:0 auto;background:#fff;padding:18px;border-radius:8px;box-shadow:0 6px 18px rgba(0,0,0,.08)}
  h1{text-align:center;margin:0 0 12px}
  .controls{display:flex;gap:8px;flex-wrap:wrap;margin-bottom:12px}
  input{padding:8px;border-radius:6px;border:1px solid #ccc}
  button{padding:8px 12px;border-radius:6px;border:none;background:#28a745;color:#fff;cursor:pointer}
  button.delete{background:#dc3545}
  table{width:100%;border-collapse:collapse}
  th,td{padding:8px;border:1px solid #e6e6e6;text-align:center}
  th{background:#667eea;color:#fff}
</style>
</head>
<body>
<div class="container">
  <h1>üì¶ Inventory Tracker</h1>
  <div class="controls">
    <input id="name" placeholder="Item Name" />
    <input id="price" type="number" placeholder="Price" step="0.01" />
    <input id="color" placeholder="Color" />
    <input id="stock" type="number" placeholder="Stock" />
    <button id="addBtn">‚ûï Add</button>
    <button id="reloadBtn" style="background:#007bff">üîÅ Reload</button>
  </div>

  <table>
    <thead>
      <tr><th>Item Name</th><th>Price</th><th>Color</th><th>Stock</th><th>Actions</th></tr>
    </thead>
    <tbody id="tbody"><tr><td colspan="5">Loading...</td></tr></tbody>
  </table>
  <div id="log" style="font-family:monospace;margin-top:12px;color:#666"></div>
</div>

<script>
  // REPLACE with your Apps Script Web App URL (the /exec URL)
  const API = "https://script.google.com/macros/s/AKfycbxefi0TlOVXtrb0Iao8b5q5X0TjLqjZQof5ZLLDL_8_Ie8BcQWo2Gx4r-aEtUo0jufY/exec";

  const el = id => document.getElementById(id);
  const log = msg => { const p = el('log'); p.textContent = msg; console.log(msg); };

  async function fetchJson(url) {
    const res = await fetch(url);
    const text = await res.text();
    try { return JSON.parse(text); }
    catch(e) { throw new Error('Invalid JSON response: ' + text); }
  }

  async function load() {
    if (!API || API.includes("PASTE_YOUR")) {
      el('tbody').innerHTML = '<tr><td colspan="5">Set API URL in script (API const)</td></tr>';
      return;
    }
    try {
      log('Loading inventory...');
      const data = await fetchJson(API);
      render(data);
      log('Loaded ' + (data.length || 0) + ' items.');
    } catch (err) {
      log('Load error: ' + err.message);
      el('tbody').innerHTML = '<tr><td colspan="5">Failed to load. Open browser console for details.</td></tr>';
      console.error(err);
    }
  }

  function render(items) {
    const tbody = el('tbody');
    if (!items || items.length === 0) {
      tbody.innerHTML = '<tr><td colspan="5">No items</td></tr>';
      return;
    }
    tbody.innerHTML = '';
    items.forEach((it, i) => {
      const tr = document.createElement('tr');
      tr.innerHTML = `
        <td>${escapeHtml(it['Item Name']||'')}</td>
        <td>${escapeHtml(it['Price']||'0')}</td>
        <td>${escapeHtml(it['Color']||'')}</td>
        <td>${escapeHtml(it['Stock']||'0')}</td>
        <td>
          <button onclick="update(${i})">Update</button>
          <button class="delete" onclick="del(${i})">Delete</button>
        </td>`;
      tbody.appendChild(tr);
    });
  }

  function escapeHtml(s) { return String(s).replace(/[&<>"']/g, c => ({'&':'&amp;','<':'&lt;','>':'&gt;','"':'&quot;',"'":'&#39;'}[c])); }

  // construct GET url and call it (no body, so no preflight)
  async function callAction(params) {
    const q = Object.keys(params).map(k => encodeURIComponent(k)+'='+encodeURIComponent(params[k])).join('&');
    const url = API + '?' + q;
    log('Calling: ' + url);
    const res = await fetchJson(url);
    return res;
  }

  document.getElementById('addBtn').addEventListener('click', async () => {
    const name = el('name').value.trim();
    if (!name) return alert('Enter item name');
    const price = el('price').value || 0;
    const color = el('color').value || '';
    const stock = el('stock').value || 0;
    try {
      await callAction({action:'add', name, price, color, stock});
      el('name').value=''; el('price').value=''; el('color').value=''; el('stock').value='';
      await load();
    } catch (err) {
      log('Add error: ' + err.message);
      alert('Add failed: ' + err.message);
    }
  });

  document.getElementById('reloadBtn').addEventListener('click', load);

  async function update(index) {
    const newStock = prompt("New stock value:");
    if (newStock === null) return;
    try {
      await callAction({action:'update', index, stock:newStock});
      await load();
    } catch (err) {
      alert('Update failed: ' + err.message);
    }
  }

  async function del(index) {
    if (!confirm('Delete this item?')) return;
    try {
      await callAction({action:'delete', index});
      await load();
    } catch (err) {
      alert('Delete failed: ' + err.message);
    }
  }

  // initial load
  load();
</script>
</body>
</html>
